<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Recipe Book</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
        }
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .card-img-top {
            border-radius: 10px 10px 0 0;
            height: 200px;
            object-fit: cover;
        }
        .card:hover {
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        .card-body {
            padding: 15px;
        }
        .card-title {
            color: #333;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        .card-text {
            color: #555;
            font-size: 1rem;
        }
        .image-container {
            position: relative;
        }

        .delete-icon {
            font-size: 1.3em; /* Size of the icon */
            color: #dc3545; /* Color of the icon */
            top: 0.25em; /* Distance from the top edge */
            right: 0.25em; /* Distance from the right edge */
            padding: 0.25em; /* Space around the icon */
        }

        .bi-x-circle-fill {
            /* Icon styling */
            color: inherit; /* Inherits the color from .delete-icon */
            border-radius: 50%; /* Optional: rounded circle around the icon */
            padding: 0.25em; /* Padding inside the circle */
        }
        .delete-icon.hidden {
            display: none;
        }
        /* Make sure to include the Bootstrap Icons stylesheet */
        .custom-switch .form-check-input {
            width: 4em !important; /* Increase the width of the switch */
            height: 2em !important; /* Adjust the height to maintain aspect ratio */
            cursor: pointer;
            margin-bottom: 5px;
        }

        .custom-switch .form-check-input:checked {
            background-color: #198754 !important; /* Bootstrap green color */
            border-color: #198754 !important; /* Bootstrap green color */
        }

        .custom-switch .form-check-input:checked::after {
            transform: translateX(1.5em) !important; /* Adjust this value based on the width of the switch */
        }
        .search-bar {
            margin: 20px 0;
        }
    </style>
</head>
<body>

<div class="container mt-3">
    <h2>Recipe Book</h2>

    <div class="search-bar">
        <input class="form-control" type="search" placeholder="Search" aria-label="Search">
    </div>

    <div class="d-flex justify-content-end custom-switch">
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" role="switch" id="toggleIconSwitch" checked>
            <label class="form-check-label" for="toggleIconSwitch"></label>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4" th:each="item : ${items}" th:id="'video-' + ${item.videoId}">
            <a th:href="@{'/detail/' + ${item.videoId}}" class="card-link">
                <div class="card">
                    <!-- Image container with relative positioning -->
                    <div class="image-container position-relative">
                        <img th:src="@{${item.thumbnailUrl}}" class="card-img-top" alt="Recipe Image">
                        <!-- Absolutely positioned 'x' icon inside the container -->
                        <a href="#" class="delete-icon position-absolute top-0 end-0" th:data-video-id="${item.videoId}">
                            <span class="delete-icon position-absolute top-0 end-0 bi bi-x-circle-fill hidden"></span>
                        </a>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title" th:text="${item.title}">Recipe Title</h5>
                        <!-- Description is commented out -->
                    </div>
                </div>
            </a>
        </div>
    </div>

</div>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('a.delete-icon').forEach(function (element) {
            element.addEventListener('click', function (event) {
                // Prevent the default anchor behavior and stop event propagation
                event.preventDefault();
                event.stopPropagation(); // Add this line
                const videoId = this.getAttribute('data-video-id');
                deleteVideo(event, videoId);
            });
        });

        // Get the switch and the delete icons
        const storedState = localStorage.getItem('switchState');
        const toggle = document.getElementById('toggleIconSwitch');
        const deleteIcons = document.querySelectorAll('.delete-icon');

        if (storedState === 'on') {
            toggle.checked = true;
            deleteIcons.forEach(icon => icon.classList.remove('hidden'));
        } else {
            toggle.checked = false;
            deleteIcons.forEach(icon => icon.classList.add('hidden'));
        }

        // Define the toggle function
        function toggleIcons() {
            deleteIcons.forEach(icon => {
                if (toggle.checked) {
                    icon.classList.remove('hidden');
                    localStorage.setItem('switchState', 'on');
                } else {
                    icon.classList.add('hidden');
                    localStorage.setItem('switchState', 'off');
                }
            });
        }

        // Attach the event listener to the switch
        toggle.addEventListener('change', toggleIcons);

        // Call the function on page load to set the initial state
        toggleIcons();
    });

    function deleteVideo(event, videoId) {
        event.preventDefault(); // Prevent the default anchor behavior

        if (confirm('Are you sure you want to delete this video?')) {
            fetch('/delete/video/' + videoId, {
                method: 'DELETE',
                // Add any needed headers, credentials, etc.
                headers: {
                    'Content-Type': 'application/json',
                    // If you're using CSRF protection, you'll need to include your CSRF token here
                },
                // If you need credentials such as cookies, include them in the request
                credentials: 'include'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    // Assume response is OK; proceed to remove the item from the DOM
                    const itemElement = document.getElementById('video-' + videoId);
                    if (itemElement) {
                        itemElement.remove(); // Remove the item's container from the DOM
                    }
                    return response.json(); // or response.text() if your server sends a non-JSON response
                })
                .then(data => {
                    console.log(data);
                    // Here you can handle redirection after deletion,
                    // Or remove the element from the DOM to reflect the change immediately.
                })
                .catch(error => {
                    console.error('There was an error deleting the video:', error);
                });
        }
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
</body>
</html>